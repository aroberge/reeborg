<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="description" content="Free Interactive Programming Tutorials">
<meta name="keywords" content="JavaScript,Python,Programming">
<meta name="author" content="AndrÃ© Roberge">
<meta name="license" content="CC BY-NC-SA 3.0">
<link href="../css/jquery-ui.custom.min.css" rel="stylesheet" >
<link rel="stylesheet" href="http://cdn.jsdelivr.net/codemirror/3.0/codemirror.css">
<link rel="stylesheet" href="../css/reeborg.css"> <!-- load after codemirror.css -->
<title>Reeborg's world</title>
</head>
<body>

<header class="blue-gradient green-border">
  <a id="logo" href="../index.html" class="fake_button">Reeborg</a>
  <div id="header-child">
    <button class="active reverse-blue-gradient" label="content-panel">Content</button>
    <button class="active reverse-blue-gradient" label="editor-panel">Editor</button>
    <button class="active reverse-blue-gradient" label="world-panel">World</button>
    <button class="blue-gradient" label="output-panel">Writings</button>
  </div>
  <div>
    <button class="blue-gradient" id="help-button">Help</button>
    <button class="blue-gradient" id="about-button">About</button>
    <button class="blue-gradient" id="contribute-button">Contribute</button>
  </div>
</header>

<div id="panels">
  <div id="content-panel" class="panel active">
    <div id="content">Loading content...</div>
  </div>
  <div id="editor-panel" class="panel active" >
    <div id="tabs">
      <ul>
        <li><a id="editor-link" href="#editor">Code</a></li>
        <li><a id="library-link" href="#library">Library</a></li>
        <li><a id="notes-link" href="#notes">Notes</a></li>
        <button class="blue-gradient float-right" id="lint">Valid code?</button> <span id="checked">Yes!</span>
        <button class="blue-gradient float-right" id="save-library">Save</button> <span id="saved">Saved!</span>
      </ul>
      <div id="editor">
        <span id="library-problem">Problem with code in library!</span>
        <textarea id="code" name="code">move();</textarea>
      </div>
      <div id="library">
        <textarea id="library-code" name="library-code">
/* Sorry - if you see this, it means that
your browser is incapable of using the
Library or the Notes the way they been have designed.

You could write code here ... but it will
not be saved for next time you visit.

Have you tried Firefox or Chrome? */
        </textarea>
      </div>
      <div id="notes">
        <br>
        <p>Keep your personal notes here; they will be available from any page on this site.
          You can choose to use html syntax for formatting.</p>
        <p>
          <form name="notes_editor" id="notes_editor">
            <textarea name="data" rows="5" id="data_entry"></textarea><br>
            <span id="undo_delete"></span><span class="float-right">HTML</span>
            <input type="checkbox" name="check_html" class="float-right"/>
            <a href="javascript:addNote();" class="blue-gradient fake_button float-right">Add Note</a><br class="clear">
          </form>
        </p>
        <div id="notes_list"></div>
      </div>
    </div>
  </div>
  <div id="world-panel" class="panel active" >
    <div id="canvas-wrapper">
        <canvas id="background_canvas" width="600" height="460"></canvas>
        <canvas id="wall_canvas" width="600" height="460"></canvas>
        <canvas id="trace_canvas" width="600" height="460"></canvas>
        <canvas id="robot_canvas" width="600" height="460"></canvas>
        <button class="blue-gradient" id="run" disabled="true" onClick="RUR.controls.run();">Execute</button>
        <button class="blue-gradient" id="pause" disabled="true" onClick="RUR.controls.pause();">Pause</button>
        <button class="blue-gradient" id="step" disabled="true" onClick="RUR.controls.step();">Step</button>
        <button class="blue-gradient" id="stop" disabled="true" onClick="RUR.controls.stop();">Stop</button>
        <button class="blue-gradient" id="reload" disabled="true" onClick="RUR.controls.reload();">Reload</button>
        <select id="select_world">
          <option value="remove" selected>Select a world</option>
          <option value="../json/empty_world.json">Empty world</option>
          <option value="../json/world_1.json">World 1</option>
          <option value="../json/test_world.json">Test world</option>
          <option value="../json/test_world2.json">Test world 2</option>
        </select>
        <div id="Reeborg-says" title="Reeborg says" style="display:none"></div>
        <div id="Reeborg-shouts" title="Reeborg shouts" style="display:none"></div>
    </div>
  </div>
  <div id="output-panel" class="panel">
    <h3>Reeborg's written notes</h3>
    <pre id="output-pre"></pre>
  </div>
</div>

<div id="help" title="Help">Retrieving...</div>
<div id="about" title="About">Retrieving...</div>
<div id="contribute" title="Contribute">Retrieving...</div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.0/jquery-ui.min.js"></script>
<script src="http://cdn.jsdelivr.net/codemirror/3.0/codemirror.js"></script>
<script src="http://cdn.jsdelivr.net/codemirror/3.0/mode/javascript/javascript.js"></script>
<script src="../js/reeborg.js"></script>

<script>
  var editor = CodeMirror.fromTextArea(document.getElementById('code'), {
    mode: 'javascript',
    tabMode: 'indent',
    lineNumbers: true,
    theme: 'reeborg-dark',
    indentUnit: 4
  });
  var library = CodeMirror.fromTextArea(document.getElementById('library-code'), {
    mode: 'javascript',
    tabMode: 'indent',
    lineNumbers: true,
    theme: 'reeborg-dark',
    indentUnit: 4
  });
  editor.widgets = [];

  function editorUpdateHints() {
    updateHints(editor);
  }

  library.widgets = [];

  function libraryUpdateHints() {
    updateHints(library);
  }
  var jshint_options = {
    eqeqeq: true,
    boss: true,
    undef: true,
    curly: true,
    nonew: true,
    browser: true,
    devel: true,
    white: false,
    plusplus: false,
    jquery: true
  };

  var globals_ = "/*globals move, avance, turn_left, RUR, output, inspect, UsedRobot, wall_in_front, is_facing_north, done, put_token, take_token, put, take*/\n";

  function updateHints(obj) {
    obj.operation(function () {
      for(var i = 0; i < obj.widgets.length; ++i)
      obj.removeLineWidget(obj.widgets[i]);
      obj.widgets.length = 0;

      JSHINT(globals_ + obj.getValue(), jshint_options);
      for(var i = 0; i < JSHINT.errors.length; ++i) {
        var err = JSHINT.errors[i];
        if(!err) continue;
        var msg = document.createElement("div");
        var icon = msg.appendChild(document.createElement("span"));
        icon.innerHTML = "!?!";
        icon.className = "lint-error-icon";
        msg.appendChild(document.createTextNode(err.reason));
        msg.className = "lint-error";
        obj.widgets.push(obj.addLineWidget(err.line - 2, msg, {
          coverGutter: false,
          noHScroll: true
        }));
      }
    });

    var info = obj.getScrollInfo();
    var after = obj.charCoords({
      line: obj.getCursor().line + 1,
      ch: 0
    }, "local").top;
    if(info.top + info.clientHeight < after) {
      obj.scrollTo(null, after - info.clientHeight + 3);
    }
  };

  $("#lint").on("click", function () {
    editorUpdateHints();
    if(editor.widgets.length === 0) {
      libraryUpdateHints();
      if(library.widgets.length !== 0) {
        $('#library-problem').show().fadeOut(4000);
      } else {
        $('#checked').show().fadeOut(1000);
      }
    }
  });

  var library_waiting;
  library.on("change", function () {
    clearTimeout(library_waiting);
    library_waiting = setTimeout(libraryUpdateHints, 1000);
  });

  setTimeout(libraryUpdateHints, 200);

  $("#select_world").change(function() {
      $("select option[value='remove']").remove();
      $.get($(this).val(), function(data) {
        RUR.world.import_(data);
        RUR.world.reset();
        RUR.controls.reload();
      });
  });

  RUR.visible_world.init();
  RUR.controls = new RUR.Controls("javascript");
</script>

<script src="../libs/jshint.js"></script>

</body>
</html>
