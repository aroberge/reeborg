<!DOCTYPE html>


<html>
  <head>
    <meta charset="utf-8"> 
    
    <title>21. Four canvases &mdash; Breakout: making a game with Python</title>
    
    <link rel="stylesheet" href="_static/reeborg.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Breakout: making a game with Python" href="index.html" />
    <link rel="next" title="22. Images and Bounding Boxes" href="images_bb.html" />
    <link rel="prev" title="20. Efficiency considerations" href="rule7.html" /> 
  
  <script>
    // intelligent scrolling of the sidebar content
    // copied from the sphinx website
    $(window).scroll(function() {
    var sb = $('.sphinxsidebarwrapper');
    var win = $(window);
    var sbh = sb.height();
    var offset = $('.sphinxsidebar').position()['top'];
    var wintop = win.scrollTop();
    var winbot = wintop + win.innerHeight();
    var curtop = sb.position()['top'];
    var curbot = curtop + sbh;
    // does sidebar fit in window?
    if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
              sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
              sb.css('top', $u.min([winbot - sbh - offset - 20,
                            $(document).height() - sbh - 200]));
          }
        }
    });
    </script>
  
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
             <a href="images_bb.html" title="22. Images and Bounding Boxes"
             accesskey="N">next</a></li>
        <li class="right" >
             <a href="rule7.html" title="20. Efficiency considerations"
             accesskey="P">previous</a> |</li>
        <li><a class="logo" href="../../index_en.html" class="fake_button">
              <img class="logo"  src="_static/robot_e.png" alt="Logo"/>Reeborg's World
            </a></li>
        <li><a href="index.html">Breakout: making a game with Python</a></li> 
      </ul>
    </div>
  
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
              <h3>Table Of Contents</h3>
              <ul>
<li><a class="reference internal" href="#">21. Four canvases</a><ul>
<li><a class="reference internal" href="#removing-a-global-variable">21.1. Removing a global variable</a></li>
<li><a class="reference internal" href="#removing-another-global-variable">21.2. Removing another global variable</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="rule7.html"
                        title="previous chapter">20. Efficiency considerations</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="images_bb.html"
                        title="next chapter">22. Images and Bounding Boxes</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/four_canvases.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="four-canvases">
<h1>21. Four canvases<a class="headerlink" href="#four-canvases" title="Permalink to this headline">¶</a></h1>
<p>As mentioned previously, the game environment includes 4
html canvases.  In order to take full advantage of them,
it is useful to define the following class:</p>
<div class="highlight-py3"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Display</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Container for the various canvases used to draw the game&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game_canvas</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">&quot;game-canvas&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game_canvas_ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_canvas</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="s">&#39;2d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_canvas</span><span class="o">.</span><span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_canvas</span><span class="o">.</span><span class="n">height</span>

        <span class="n">main_canvas</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">&quot;main-canvas&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_canvas_ctx</span> <span class="o">=</span> <span class="n">main_canvas</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>

        <span class="n">background_canvas</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">&quot;background-canvas&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background_canvas_ctx</span> <span class="o">=</span> <span class="n">background_canvas</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>

        <span class="n">far_background_canvas</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">&quot;far-background-canvas&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">far_background_canvas_ctx</span> <span class="o">=</span> <span class="n">far_background_canvas</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see, an instance of this class will have four drawing contexts
as attribute but a single canvas instance, as the others have been used
only as local variables.  The one canvas instance, <tt class="docutils literal"><span class="pre">self.game_canvas</span></tt>,
that is an attribute of this class is the only one that can be interacted
with using a mouse as the browser treats it as though it laid on top of the
other three.</p>
<div class="topic">
<p class="topic-title first">Your turn!</p>
<p>Add the class <tt class="docutils literal"><span class="pre">Display</span></tt> as above.  Then, modify your <tt class="docutils literal"><span class="pre">Game.__init__</span></tt>
method as follows, using the minimal amount of code to make it work:</p>
<div class="highlight-py3"><div class="highlight"><pre> <span class="k">class</span> <span class="nc">Game</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="k">global</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">get_mouse_position</span>
         <span class="c">#self.canvas = doc[&quot;game-canvas&quot;]</span>
         <span class="c">#self.ctx = self.canvas.getContext(&#39;2d&#39;)</span>

         <span class="c">#background_canvas = doc[&quot;background-canvas&quot;]</span>
         <span class="c">#self.background_canvas_ctx = background_canvas.getContext(&quot;2d&quot;)</span>

<span class="hll">         <span class="c">#New code here</span>
</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="k">None</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="k">True</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="mi">30</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">time_between_frames</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">fps</span>

         <span class="n">doc</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;keydown&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_keydown_events</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">clear_screen</span><span class="p">()</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">write_help</span><span class="p">()</span>
         <span class="c">#</span>
         <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span>
         <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span>
         <span class="n">get_mouse_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mouse_position</span>
</pre></div>
</div>
<p>Note that I have commented out some existing code which can be removed altogether.
Make sure to test your code!</p>
</div>
<div class="section" id="removing-a-global-variable">
<h2>21.1. Removing a global variable<a class="headerlink" href="#removing-a-global-variable" title="Permalink to this headline">¶</a></h2>
<p>Currently, we have 3 global variables defined in <tt class="docutils literal"><span class="pre">Game.__init__</span></tt>:
<tt class="docutils literal"><span class="pre">canvas</span></tt>, <tt class="docutils literal"><span class="pre">ctx</span></tt>, <tt class="docutils literal"><span class="pre">get_mouse_position</span></tt>.  Ideally, we should have
no global variables.   Let&#8217;s see if we can start removing them.</p>
<p>We will first start by removing <tt class="docutils literal"><span class="pre">ctx</span></tt>.  If you look at the entire
code, you will see that <tt class="docutils literal"><span class="pre">ctx</span></tt> is used in the <tt class="docutils literal"><span class="pre">draw</span></tt> method of
both the <tt class="docutils literal"><span class="pre">Ball</span></tt> and <tt class="docutils literal"><span class="pre">Paddle</span></tt> classes.  To remove it as a global
variables, we will pass it as a variable of the <tt class="docutils literal"><span class="pre">__init__</span></tt> method
when we create an instance of these classes.  For example, we will have</p>
<div class="highlight-py3"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Paddle</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="hll">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bounding_box</span><span class="p">()</span>
<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span> <span class="o">=</span> <span class="n">ctx</span>
</span>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">fillStyle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">fillRect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</span>

<span class="k">class</span> <span class="nc">Game</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
   <span class="c"># ...</span>

    <span class="k">def</span> <span class="nf">start_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ball</span> <span class="o">=</span> <span class="n">Ball</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">height</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="n">dy</span><span class="o">=-</span><span class="mi">5</span><span class="p">)</span>
<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">paddle</span> <span class="o">=</span> <span class="n">Paddle</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">height</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="p">)</span>
</span></pre></div>
</div>
<div class="topic">
<p class="topic-title first">Your turn!</p>
<p>Implement the change shown above. Do the same for the <tt class="docutils literal"><span class="pre">Ball</span></tt> class.
Then remove <tt class="docutils literal"><span class="pre">ctx</span></tt> as a global variable from within <tt class="docutils literal"><span class="pre">Game.__init__</span></tt>.</p>
</div>
</div>
<div class="section" id="removing-another-global-variable">
<h2>21.2. Removing another global variable<a class="headerlink" href="#removing-another-global-variable" title="Permalink to this headline">¶</a></h2>
<p>Next, we set our sights on removing <tt class="docutils literal"><span class="pre">canvas</span></tt> as a global variable.
If we examine the <tt class="docutils literal"><span class="pre">Paddle</span></tt> class, we see that <tt class="docutils literal"><span class="pre">canvas</span></tt> appears
only in the following method:</p>
<div class="highlight-py3"><div class="highlight"><pre><span class="k">def</span> <span class="nf">stay_in_world</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">&gt;</span> <span class="n">canvas</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bounding_box</span><span class="p">()</span>
</pre></div>
</div>
<p>Similarly, for the <tt class="docutils literal"><span class="pre">Ball</span></tt> class,  the variable <tt class="docutils literal"><span class="pre">canvas</span></tt> appears
also only in the <tt class="docutils literal"><span class="pre">stay_in_world</span></tt> method:</p>
<div class="highlight-py3"><div class="highlight"><pre><span class="k">def</span> <span class="nf">stay_in_world</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">canvas</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">canvas</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">game</span><span class="o">.</span><span class="n">game_over</span><span class="p">()</span>
</pre></div>
</div>
<p>So, it seems that all we need is only the  <tt class="docutils literal"><span class="pre">width</span></tt> and <tt class="docutils literal"><span class="pre">height</span></tt>
attribute of the canvas.  We could pass <tt class="docutils literal"><span class="pre">canvas.width</span></tt> as an
argument to <tt class="docutils literal"><span class="pre">Paddle.__init__</span></tt>, and pass both <tt class="docutils literal"><span class="pre">canvas.width</span></tt> and
<tt class="docutils literal"><span class="pre">canvas.height</span></tt> as arguments to <tt class="docutils literal"><span class="pre">Ball.__init__</span></tt> and use these
values.  Making this relatively simple change would be enough
to get rid of <tt class="docutils literal"><span class="pre">canvas</span></tt> as a global variable.</p>
<p>However, I will suggest a more complex change, one that will
give us some flexibility needed for later.  Yes, I know, I told
you to pay attention to YAGNI (our Rule #5).  However, I wish
to draw your attention to what these two <tt class="docutils literal"><span class="pre">stay_in_world</span></tt> method
set out to do, and how they do it.</p>
<p>We want to restrict the movement of a ball and paddle so that they
stay within the confine of their &#8220;world&#8221;.  Their &#8220;world&#8221; itself is
contained withing the html canvas that we use to draw the game.
However, very often (and this will be eventually the case for our game
as well), we want to have other &#8220;objects&#8221; shown within a game
environment, in addition to the &#8220;game world&#8221;.  For example, we might
want to indicate the score, or the number of &#8220;lives&#8221; remaining, or
the game level being currently played.  In other types of game we
might want to display something like the player&#8217;s &#8220;health&#8221;, or
some other information.  So, usually, the game display has an
area reserved for some animation and some other area reserved for
information given to the human player.</p>
<p>So far in our game, we have used the entire &#8220;world&#8221; as available
for the ball.  In doing so, we have <strong>hard-coded</strong> some values:
the <strong>coordinates</strong> of the canvas&#8217; boundaries.   If you look
at the code above, you will see that we compare the coordinates
of the ball (or of the paddle) with those of the boundaries
of the world <tt class="docutils literal"><span class="pre">x_min=0</span></tt>, <tt class="docutils literal"><span class="pre">y_min=0</span></tt>,
<tt class="docutils literal"><span class="pre">x_min=canvas.width</span></tt>, <tt class="docutils literal"><span class="pre">y_min=canvas.height</span></tt>, not by referring
to them using some meaningful variable names, like <tt class="docutils literal"><span class="pre">x_min</span></tt>, <tt class="docutils literal"><span class="pre">y_min</span></tt>,
etc., but by their exact values: <tt class="docutils literal"><span class="pre">0,</span> <span class="pre">0,</span> <span class="pre">canvas.width,</span> <span class="pre">canvas.height</span></tt>.</p>
<p>Instead of using such hard-coded values, a better, more flexible
approach is to use the coordinates of an object that is
passed to a <tt class="docutils literal"><span class="pre">Ball</span></tt> or <tt class="docutils literal"><span class="pre">Paddle</span></tt> instance upon creation.
Since we will use this object in the <tt class="docutils literal"><span class="pre">stay_in_world</span></tt>
method, let&#8217;s call this object <tt class="docutils literal"><span class="pre">world</span></tt> and use it as follows:</p>
<div class="highlight-py3"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Paddle</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                 <span class="n">world</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="c"># ...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">world</span>

    <span class="k">def</span> <span class="nf">stay_in_world</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="s">&quot;x_min&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="s">&quot;x_min&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="s">&quot;x_max&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="s">&quot;x_max&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_bounding_box</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Game</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">start_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">world</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;x_min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;y_min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;x_max&quot;</span><span class="p">:</span> <span class="n">canvas</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                 <span class="s">&quot;y_max&quot;</span><span class="p">:</span> <span class="n">canvas</span><span class="o">.</span><span class="n">height</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ball</span> <span class="o">=</span> <span class="n">Ball</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">height</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="n">dy</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paddle</span> <span class="o">=</span> <span class="n">Paddle</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">height</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span> <span class="n">world</span><span class="o">=</span><span class="n">world</span><span class="p">)</span>
</pre></div>
</div>
<div class="topic">
<p class="topic-title first">Your turn!</p>
<p>Implement the above approach for both the <tt class="docutils literal"><span class="pre">Paddle</span></tt> and <tt class="docutils literal"><span class="pre">Ball</span></tt> class so that
you can eliminate the use of <tt class="docutils literal"><span class="pre">canvas</span></tt> as a global variable.  Note that getting
<tt class="docutils literal"><span class="pre">Ball.stay_in_world</span></tt> correct is a bit tricky...</p>
</div>
<p>The solution I obtained can be revealed by clicking on the following &#8220;hint&#8221;.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p>We have already seen how to modify the <tt class="docutils literal"><span class="pre">Paddle</span></tt> class to
remove the need to have <tt class="docutils literal"><span class="pre">canvas</span></tt> as a global variable.
To be able to remove it completely, we need to change the
code for the <tt class="docutils literal"><span class="pre">Ball</span></tt> class as follows:</p>
<div class="highlight-py3"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Ball</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                 <span class="n">world</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="c">#...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">world</span>

    <span class="k">def</span> <span class="nf">stay_in_world</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="s">&quot;x_min&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="s">&quot;x_min&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="s">&quot;x_max&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="s">&quot;x_max&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="s">&quot;y_min&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="s">&quot;y_min&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="s">&quot;y_max&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="p">[</span><span class="s">&quot;y_max&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">game</span><span class="o">.</span><span class="n">game_over</span><span class="p">()</span>
</pre></div>
</div>
<p>and to change the line that starts with <tt class="docutils literal"><span class="pre">self.ball</span></tt> in the
<tt class="docutils literal"><span class="pre">Game.start_animation</span></tt> method:</p>
<div class="last highlight-py3"><div class="highlight"><pre><span class="k">def</span> <span class="nf">start_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">world</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;x_min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;y_min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;x_max&quot;</span><span class="p">:</span> <span class="n">canvas</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
             <span class="s">&quot;y_max&quot;</span><span class="p">:</span> <span class="n">canvas</span><span class="o">.</span><span class="n">height</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ball</span> <span class="o">=</span> <span class="n">Ball</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">height</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="n">dy</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span> <span class="n">world</span><span class="o">=</span><span class="n">world</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">paddle</span> <span class="o">=</span> <span class="n">Paddle</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">height</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span> <span class="n">world</span><span class="o">=</span><span class="n">world</span><span class="p">)</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;mousemove&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">paddle</span><span class="o">.</span><span class="n">mouse_move</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>  
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
             <a href="images_bb.html" title="22. Images and Bounding Boxes"
             >next</a></li>
        <li class="right" >
             <a href="rule7.html" title="20. Efficiency considerations"
             >previous</a> |</li>
        <li><a class="logo" href="../../index_en.html" class="fake_button">
              <img class="logo"  src="_static/robot_e.png" alt="Logo"/>Reeborg's World
            </a></li>
        <li><a href="index.html">Breakout: making a game with Python</a></li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 
          <a href="mailto:andre.roberge@gmail.com">André Roberge </a>
        
       - Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  <script> 
  $(document).ready(function() {
      $('.hint').children().hide();
      $('.hint p.admonition-title').show().css('cursor', 'pointer');
      $('.hint p.admonition-title').click( function() {$(this).siblings().show().css('cursor', 'auto');})
  });
  </script>
  </body>
</html>