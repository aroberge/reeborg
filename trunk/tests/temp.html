<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Canvas test</title>
        <style>
        #canvas-wrapper {
            position: relative;
            top:100px;
            left:100px;

        }
        canvas {
position:absolute;
    border: 1px solid green;
    left:0px;
    top:0px;
            }
        </style>
    </head>
    <body>
        <div id="canvas-wrapper">
            <canvas id="canvas2" width="600" height="480">
                
            </canvas>
            <canvas id="canvas1" width="600" height="480">
                
            </canvas>
        </div>
    <script>
// the following is to draw dashed line; code from 
// http://stackoverflow.com/questions/4576724/dotted-stroke-in-canvas

var CP = window.CanvasRenderingContext2D && CanvasRenderingContext2D.prototype;

CP.dashedLine = function(x, y, x2, y2, da) {
    if (!da) {
        da = [10,5];
    }
    this.save();
    var dx = (x2-x), dy = (y2-y);
    var len = Math.sqrt(dx*dx + dy*dy);
    var rot = Math.atan2(dy, dx);
    this.translate(x, y);
    this.moveTo(0, 0);
    this.rotate(rot);       
    var dc = da.length;
    var di = 0, draw = true;
    x = 0;
    while (len > x) {
        x += da[di++ % dc];
        if (x > len) {
            x = len;
        }
        draw ? this.lineTo(x, 0): this.moveTo(x, 0);
        draw = !draw;
    }       
    this.restore();
};

CP.draw_line = function(x, y, x2, y2){
    this.beginPath();
    this.moveTo(x, y);
    this.lineTo(x2, y2);
    this.stroke();
}

        var canvas1 = document.getElementById("canvas1");
        var canvas2 = document.getElementById("canvas2");
        var ctx = canvas1.getContext("2d");
        var ctx2 = canvas2.getContext("2d");
        var img = new Image();


    var world = {
        size: 40,
        rows: Math.floor(canvas1.height/40)-2,
        cols: Math.floor(canvas1.width/40)-2,
        thickness: 5,
        robot_y_offset : 6,
        robot_x_offset : 9,
        color: "brown",
        draw : function (ctx, canvas){
            this.height = canvas.height;
            ctx.fillStyle = this.color;
            ctx.strokeStyle = "#eee";
            this.draw_grid(ctx, canvas);
            for (var i = 1; i <= this.cols; i++) {
                this.draw_north_wall(ctx, i, 0);
            };
            for (i = 1; i <= this.rows; i++) {
                this.draw_east_wall(ctx, 0, i);
            };
            this.draw_east_wall(ctx, 2, 2);
            this.draw_north_wall(ctx, 3, 3);
        },
        draw_grid : function (ctx, canvas){
            for (var i = 1; i <= this.cols; i++) {
                ctx.draw_line((i+1)*this.size, this.size, (i+1)*this.size, canvas.height-this.size);
            };
            for (i = 0; i <= this.rows; i++) {
                ctx.draw_line(this.size, (i+1)*this.size, canvas.width-this.size, (i+1)*this.size);
            };
        },
        draw_north_wall : function(ctx, i, j){
            ctx.fillRect(i*this.size, this.height - (j+1)*this.size, this.size, this.thickness);
        },
        draw_east_wall : function(ctx, i, j){
            ctx.fillRect((i+1)*this.size, this.height - (j+1)*this.size, this.thickness, this.size);
        },
    };

    img.src = '../src/images/robot_e.png';
      
    var x_arr = [], robot;
    for (var i=0; i < 10; i++){
        robot = {};
        robot.x = world.size + i*world.size + world.robot_x_offset;
        robot.y = (i+1)*world.size + world.robot_y_offset;
        x_arr.push(robot);
    }
    world.draw(ctx2, canvas2);

function doMove() {
    var robot;
 if (x_arr.length !== 0){
    ctx.clearRect(0, 0, canvas1.width, canvas1.height);
    robot = x_arr.shift();
    ctx.drawImage(img, robot.x, robot.y);
    setTimeout(doMove, 500); // call doMove() in 20 msec
    }
}
doMove();

   
    // create static series of frames
    // draw frames as animation
    // create series of frames programmatically
    // add editor - code mirror
    // create series of frames from simple program in editor and animate
    // add animation buttons: run, pause, stop, reload  (one at a time)
    // add background canvas
    // have multiple canvases:
    //   pure background, user walls, tokens, oil leak, robot
    //  add possibility to follow robot
    </script>
    </body>
</html>