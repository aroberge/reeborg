<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Canvas test</title>
        <style>
        #canvas-wrapper {
            position: relative;
            top:100px;
            left:100px;

        }
        canvas {
position:absolute;
    border: 1px solid green;
    left:0px;
    top:0px;
            }
        </style>
    </head>
    <body>
        <div id="canvas-wrapper">
            <canvas id="canvas0" width="600" height="480">

            </canvas>
            <canvas id="canvas1" width="600" height="480">

            </canvas>
            <canvas id="canvas2" width="600" height="480">

            </canvas>
        </div>
    <script>
// the following is to draw dashed line; code from
// http://stackoverflow.com/questions/4576724/dotted-stroke-in-canvas

var CP = window.CanvasRenderingContext2D && CanvasRenderingContext2D.prototype;

CP.dashedLine = function(x, y, x2, y2, da) {
    if (!da) {
        da = [10,5];
    }
    this.save();
    var dx = (x2-x), dy = (y2-y);
    var len = Math.sqrt(dx*dx + dy*dy);
    var rot = Math.atan2(dy, dx);
    this.translate(x, y);
    this.moveTo(0, 0);
    this.rotate(rot);
    var dc = da.length;
    var di = 0, draw = true;
    x = 0;
    while (len > x) {
        x += da[di++ % dc];
        if (x > len) {
            x = len;
        }
        draw ? this.lineTo(x, 0): this.moveTo(x, 0);
        draw = !draw;
    }
    this.restore();
};

CP.draw_line = function(x, y, x2, y2){
    this.beginPath();
    this.moveTo(x, y);
    this.lineTo(x2, y2);
    this.stroke();
}

var img = new Image();
img.src = '../src/images/robot_e.png';


var world = {
    init: function (){
        this.rows = Math.floor(canvas1.height/this.wall_length)-2;
        this.cols = Math.floor(canvas1.width/this.wall_length)-2;
        this.background_canvas = document.getElementById("canvas0");
        this.background_ctx = this.background_canvas.getContext("2d");
        this.height = this.background_canvas.height;
        this.wall_ctx = document.getElementById("canvas1").getContext("2d");
        this.robot_ctx = document.getElementById("canvas2").getContext("2d");
    },
    wall_length: 40,
    wall_thickness: 5,
    robot_y_offset : 6,
    robot_x_offset : 9,
    wall_color: "brown",
    potential_wall_color: "#f0f0f0",
    ctx: null,
    draw : function (){
        this.draw_grid();
        // this.draw_east_wall(ctx, 2, 2);
        // this.draw_north_wall(ctx, 3, 3);
        // this.draw_east_wall(ctx, 5, 5);
        // this.draw_north_wall(ctx, 5, 5);
        // this.draw_east_wall(ctx, 4, 5);
        // this.draw_north_wall(ctx, 5, 4);
    },
    draw_grid : function (){
        for (var i = 0; i <= this.cols; i++) {
            for (var j = 0; j <= this.rows; j++){
                if (i === 0 && j !== 0) {
                    this.ctx = this.wall_ctx;
                    this.ctx.fillStyle = this.wall_color;
                    this.draw_east_wall(i, j);
                } else if (i !== 0 && j === 0) {
                    this.ctx = this.wall_ctx;
                    this.ctx.fillStyle = this.wall_color;
                    this.draw_north_wall(i, j);
                } else if (i === 0 && j === 0){
                    continue;
                } else {
                    this.ctx = this.background_ctx;
                    this.ctx.fillStyle = this.potential_wall_color;
                    this.draw_north_wall (i, j);
                    this.draw_east_wall (i, j);
                }
            }
        }
    },
    draw_north_wall : function(i, j){
        this.ctx.fillRect(i*this.wall_length, this.height - (j+1)*this.wall_length,
                          this.wall_length+this.wall_thickness, this.wall_thickness);
    },
    draw_east_wall : function(i, j){
        this.ctx.fillRect((i+1)*this.wall_length, this.height - (j+1)*this.wall_length,
                          this.wall_thickness, this.wall_length);
    },
    play_frames : function () {
        var robot;
        this.ctx = world.robot_ctx;
         if (x_arr.length !== 0){
            this.ctx.clearRect(0, 0, canvas1.width, canvas1.height);
            robot = x_arr.shift();
            this.ctx.drawImage(img, robot.x, robot.y);
            setTimeout(world.play_frames, 500);
        }
    }
};
world.init();



var x_arr = [], robot;
for (var i=0; i < 10; i++){
    robot = {};
    robot.x = world.wall_length + i*world.wall_length + world.robot_x_offset;
    robot.y = (i+1)*world.wall_length + world.robot_y_offset;
    x_arr.push(robot);
}
world.draw();
world.play_frames();


    // create static series of frames
    // draw frames as animation
    // create series of frames programmatically
    // add editor - code mirror
    // create series of frames from simple program in editor and animate
    // add animation buttons: run, pause, stop, reload  (one at a time)
    // add background canvas
    // have multiple canvases:
    //   pure background, user walls, tokens, oil leak, robot
    //  add possibility to follow robot
    </script>
    </body>
</html>